<div class="section-tabs">
    <div class="tab active" data-tab="lancamentos">Lançamentos Financeiros</div>
    <div class="tab" data-tab="animais">Animais</div>
    <div class="tab" data-tab="rebanhos">Rebanhos</div>
    <div class="tab" data-tab="pastagens">Pastagens</div>
    <div class="tab" data-tab="movimentacoes">Movimentações</div>
    <div class="tab" data-tab="usuarios">Usuários</div>
</div>

<div class="content-area">
    <!-- Lançamentos Financeiros -->
    <div id="lancamentos" class="tab-content active">
        <div class="section-header">
            <h2>Lançamentos Financeiros</h2>
            <button class="btn btn-primary" id="addLancamento">
                <i class="fas fa-plus"></i> Novo Lançamento
            </button>
        </div>
        <div class="table-container">
            <table id="lancamentosTable">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Categoria</th>
                        <th>Valor</th>
                        <th>Data</th>
                        <th>Animal</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dados serão inseridos via JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Animais -->
    <div id="animais" class="tab-content">
        <div class="section-header">
            <h2>Animais</h2>
            <button class="btn btn-primary" id="addAnimal">
                <i class="fas fa-plus"></i> Novo Animal
            </button>
        </div>
        <div class="table-container">
            <table id="animaisTable">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>Sexo</th>
                        <th>Nascimento</th>
                        <th>Peso</th>
                        <th>Raça</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dados serão inseridos via JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Rebanhos -->
    <div id="rebanhos" class="tab-content">
        <div class="section-header">
            <h2>Rebanhos</h2>
            <button class="btn btn-primary" id="addRebanho">
                <i class="fas fa-plus"></i> Novo Rebanho
            </button>
        </div>
        <div class="table-container">
            <table id="rebanhosTable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Capacidade</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dados serão inseridos via JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pastagens -->
    <div id="pastagens" class="tab-content">
        <div class="section-header">
            <h2>Pastagens</h2>
            <button class="btn btn-primary" id="addPastagem">
                <i class="fas fa-plus"></i> Nova Pastagem
            </button>
        </div>
        <div class="table-container">
            <table id="pastagensTable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Área (ha)</th>
                        <th>Capacidade</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dados serão inseridos via JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Movimentações -->
    <div id="movimentacoes" class="tab-content">
        <div class="section-header">
            <h2>Movimentações de Animais</h2>
            <button class="btn btn-primary" id="addMovimentacao">
                <i class="fas fa-plus"></i> Nova Movimentação
            </button>
        </div>
        <div class="table-container">
            <table id="movimentacoesTable">
                <thead>
                    <tr>
                        <th>Animal</th>
                        <th>Pastagem</th>
                        <th>Entrada</th>
                        <th>Saída</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dados serão inseridos via JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Usuários -->
    <div id="usuarios" class="tab-content">
        <div class="section-header">
            <h2>Gerenciar Usuários</h2>
            <button class="btn btn-primary" id="addUsuario">
                <i class="fas fa-user-plus"></i> Novo Usuário
            </button>
        </div>
        <div class="table-container">
            <table id="usuariosTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Tipo</th>
                        <th>E-mail</th>
                        <th>Status</th>
                        <th>Último Login</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in usuarios %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>
                            <div class="user-info">
                                <div class="user-avatar">
                                    <i class="fas fa-user-circle"></i>
                                </div>
                                <div class="user-details">
                                    <strong>{{ user.get_full_name|default:user.username }}</strong>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="role-badge role-{{ user.role|lower }}">
                                {{ user.get_role_display }}
                            </span>
                        </td>                        
                        <td>{{ user.email }}</td>
                        <td>
                            {% if user.is_active %}
                            <span class="badge badge-success">Ativo</span>
                            {% else %}
                            <span class="badge badge-danger">Inativo</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if user.last_login %}
                            {{ user.last_login|date:"d/m/Y H:i" }}
                            {% else %}
                            <span class="text-muted">Nunca logou</span>
                            {% endif %}
                        </td>
                        <td class="actions">
                            <button class="btn btn-secondary btn-sm" onclick="editarUsuario('{{ user.id }}')"
                                title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            {% if user.is_active %}
                            <button class="btn btn-warning btn-sm" onclick="desativarUsuario('{{ user.id }}')"
                                title="Desativar">
                                <i class="fas fa-user-slash"></i>
                            </button>
                            {% else %}
                            <button class="btn btn-success btn-sm" onclick="ativarUsuario('{{ user.id }}')"
                                title="Ativar">
                                <i class="fas fa-user-check"></i>
                            </button>
                            {% endif %}
                            {% if user.id != request.user.id %}
                            <button class="btn btn-danger btn-sm" onclick="excluirUsuario('{{ user.id }}')"
                                title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                            {% else %}
                            <button class="btn btn-outline btn-sm" disabled
                                title="Não é possível excluir seu próprio usuário">
                                <i class="fas fa-trash"></i>
                            </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="9" class="text-center">
                            <div class="empty-state">
                                <i class="fas fa-users fa-3x"></i>
                                <h3>Nenhum usuário encontrado</h3>
                                <p>Clique no botão "Novo Usuário" para adicionar o primeiro usuário ao sistema.</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Paginação para usuários -->
        {% if usuarios.has_other_pages %}
        <div class="pagination">
            <div class="pagination-info">
                Mostrando {{ usuarios.start_index }} - {{ usuarios.end_index }} de {{ usuarios.paginator.count }}
                usuários
            </div>
            <div class="pagination-controls">
                {% if usuarios.has_previous %}
                <a href="?page=1" class="btn btn-outline btn-sm">Primeira</a>
                <a href="?page={{ usuarios.previous_page_number }}" class="btn btn-outline btn-sm">Anterior</a>
                {% endif %}

                {% for num in usuarios.paginator.page_range %}
                {% if usuarios.number == num %}
                <span class="btn btn-primary btn-sm active">{{ num }}</span>
                {% elif num > usuarios.number|add:'-3' and num < usuarios.number|add:'3' %} <a href="?page={{ num }}"
                    class="btn btn-outline btn-sm">{{ num }}</a>
                    {% endif %}
                    {% endfor %}

                    {% if usuarios.has_next %}
                    <a href="?page={{ usuarios.next_page_number }}" class="btn btn-outline btn-sm">Próxima</a>
                    <a href="?page={{ usuarios.paginator.num_pages }}" class="btn btn-outline btn-sm">Última</a>
                    {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Modal para Cadastro/Edição de Usuários -->
<div id="userModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="userModalTitle">Novo Usuário</h3>
            <button type="button" id="closeUserModal" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
            <form id="userForm" method="POST">
                {% csrf_token %}
                <input type="hidden" id="usuario_id" name="usuario_id">

                <div class="form-row">
                    <div class="form-group">
                        <label for="username">Username *</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="email">E-mail *</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="first_name">Nome</label>
                        <input type="text" id="first_name" name="first_name">
                    </div>
                    <div class="form-group">
                        <label for="last_name">Sobrenome</label>
                        <input type="text" id="last_name" name="last_name">
                    </div>
                </div>

                <div class="form-row" id="passwordFields">
                    <div class="form-group">
                        <label for="password">Senha *</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <div class="form-group">
                        <label for="confirm_password">Confirmar Senha *</label>
                        <input type="password" id="confirm_password" name="confirm_password" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="groups">Grupos</label>
                        <select id="groups" name="groups" multiple class="form-select">
                            {% for group in grupos %}
                            <option value="{{ group.id }}">{{ group.name }}</option>
                            {% endfor %}
                        </select>
                        <small class="form-text">Segure Ctrl para selecionar múltiplos grupos</small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-check">
                        <input type="checkbox" id="is_active" name="is_active" class="form-check-input" checked>
                        <label for="is_active" class="form-check-label">Usuário Ativo</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" id="is_staff" name="is_staff" class="form-check-input">
                        <label for="is_staff" class="form-check-label">Acesso ao Admin</label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Usuário</button>
                </div>
            </form>
        </div>
    </div>
</div>